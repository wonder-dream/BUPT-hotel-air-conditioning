# 波普特酒店空调系统 - 功能测试指南

本指南将指导你如何完整测试系统的各项功能，包括入住、空调控制、调度监控和结账报表。

## 1. 启动系统

请确保你已经运行了以下两个脚本（保持窗口打开）：
1. 双击运行 `start_backend.bat` (启动后端 API)
2. 双击运行 `start_frontend.bat` (启动前端界面)

打开浏览器访问前端地址（通常是 http://localhost:5173）。

---

## 2. 角色扮演测试流程

建议开启两个浏览器窗口：
- **窗口 A**：模拟前台和管理员（用于办理入住、监控、结账）
- **窗口 B**：模拟住客（用于控制空调）

### 第一步：前台办理入住
**操作角色**：前台 (窗口 A)
**页面**：点击导航栏或访问 `/reception`

1. 点击左侧 **"入住办理"**。
2. 填写测试信息：
   - 姓名：`测试员1`
   - 手机：`13800000001`
   - 身份证：`110101199001010001`
   - 房间号：选择 `301`
3. 点击 **"确认"**。
   - ✅ **预期结果**：提示"入住成功"，显示房间和订单信息。
4. 重复上述步骤，为 `302`, `303`, `304` 房间也办理入住（为了测试调度队列）。
**注意：每个测试员信息需均不相同**

### 第二步：客户开启空调
**操作角色**：住客 (窗口 B)
**页面**：访问 `/room/301`（每个房间有独立页面）

1. 直接访问对应房间的页面（如 `/room/301`）。
2. 查看当前状态，应为"已关闭"。
3. 点击 **"开启"** 按钮。
   - ✅ **预期结果**：状态变为"已开启"，模式显示"制冷"（默认）。
4. 调节设置：
   - 温度：拖动滑块或点击加减号，设为 **22°C**。
   - 风速：点击 **"高"**。
5. 观察费用：
   - ✅ **预期结果**：等待几秒后，"累计使用费用"开始上涨（高风速涨得快）。
   - ✅ **预期结果**：当前温度（状态栏显示）应该开始缓慢下降。

### 第三步：多房间调度测试 (核心功能)
**操作角色**：住客 (窗口 B) & 管理员 (窗口 A)

1. **窗口 B (住客)**：
   - 打开新标签页访问 `/room/302` -> 开机 -> 风速设为 **"中"**。
   - 打开新标签页访问 `/room/303` -> 开机 -> 风速设为 **"低"**。
   - 此时已有 3 个房间（301, 302, 303）在运行，达到服务上限。

2. **窗口 B (住客)**：
   - 打开新标签页访问 `/room/304` -> 开机 -> 风速设为 **"高"**。

3. **窗口 A (管理员)**：
   - 进入 **"空调监控"** 页面 (`/monitor`)。
   - ✅ **预期结果**：
     - **服务队列**：应该包含 301(高), 304(高), 302(中)。
     - **等待队列**：应该包含 303(低)。
     - **原因**：304(高风) 优先级高于 303(低风)，发生了**抢占调度**。303 被挤入等待队列。

### 第四步：温控与自动待机
**操作角色**：管理员 (窗口 A) 或 住客 (窗口 B)

1. 观察正在运行的房间（例如 301）。
2. 当 **当前温度** 降至 **目标温度** (22°C) 时：
   - ✅ **预期结果**：状态变为 **"待机"** (Standby) 或监控页面的状态灯变色。
   - ✅ **预期结果**：服务资源释放，等待队列中的房间（如 303）应该自动补位进入服务队列。
3. 等待一段时间（模拟回温）：
   - 当温度回升超过 1°C（例如变回 23°C）时。
   - ✅ **预期结果**：空调自动重新启动，再次申请服务。

### 第五步：结账与报表
**操作角色**：前台 (窗口 A)

1. 进入 **"前台服务"** (`/reception`)。
2. 点击左侧 **"结账办理"**。
3. 输入房间号 `301`，点击 **"确认"**。
   - ✅ **预期结果**：显示详单，包括房费和空调费。
4. 点击 **"立即支付"**。
   - ✅ **预期结果**：提示支付成功，房间状态重置为空闲。

### 第六步：查看报表
**操作角色**：经理 (窗口 A)

1. 进入 **"统计报表"** (`/report`)。
2. 选择今天日期，点击 **"查询"**。
   - ✅ **预期结果**：
     - 统计卡片显示总收入、空调收入等。
     - 下方列表中出现刚才 301 的订单记录，状态为"已退房"。

---

## 3. 常见问题排查

- **Q: 费用不增加？**
  - A: 检查后端窗口是否有报错。确保房间处于"运行中"状态（非待机、非等待）。
- **Q: 调度没反应？**
  - A: 调度器每秒运行一次，可能有 1-2 秒延迟。确保已开启至少 4 个房间才能看到排队效果。
- **Q: 乱码？**
  - A: 确保使用了提供的 `start_backend.bat` 启动，它会自动修复编码问题。
